/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    UPHL-BioNGS/Cecret Nextflow config file
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Default config options for all compute environments
----------------------------------------------------------------------------------------
*/

// Global default params, used in configs
params {

    // Input options
    params.sample_sheet                         = null
    params.reads                                = null
    params.single_reads                         = null
    params.fastas                               = null
    params.multifastas                          = null
    params.nanopore                             = null
    params.sra_accessions                       = []
    params.genome_accessions                    = []
    params.primer_bed                           = null
    params.amplicon_bed                         = null
    params.primer_set                           = null
    params.reference_genome                     = null
    params.gff                                  = null
    params.outdir                               = 'cecret'
    params.species                              = 'sarscov2'

    //# specifying the core workflow
    params.trimmer                              = 'ivar'
    params.cleaner                              = 'seqyclean'
    params.aligner                              = 'bwa'
    params.msa                                  = 'mafft'

    //# to toggle off processes
    params.aci                                  = false
    params.bbnorm                               = false
    params.bcftools_variants                    = true
    params.fastqc                               = true
    params.igv_reports                          = false
    params.ivar_variants                        = false
    params.samtools_stats                       = true
    params.samtools_coverage                    = true
    params.samtools_depth                       = true
    params.samtools_flagstat                    = true
    params.samtools_ampliconstats               = true
    params.samtools_plot_ampliconstats          = true
    params.markdup                              = false
    params.filter                               = false
    params.multiqc                              = true

    //# for optional route of tree generation and counting snps between samples
    params.relatedness                          = false
    params.snpdists                             = true
    params.iqtree2                              = true
    params.heatcluster                          = true
    params.phytreeviz                           = true

    //# parameters for processes with their default values
    params.artic_options                        = '--normalise 200 --skip-nanopolish --medaka --medaka-model r941_min_high_g360'
    params.artic_read_filtering_options         = '--min-length 400 --max-length 700'
    params.bbnorm_options                       = 'target=200 min=5'
    params.bcftools_variants_options            = ''
    params.fastp_options                        = ''
    params.fastqc_options                       = ''
    params.filter_options                       = ''
    params.heatcluster_options                  = '-t png'
    params.igv_reports_options                  = '--flanking 1000'
    params.iqtree2_options                      = '-ninit 2 -n 2 -me 0.05 -m GTR'
    params.ivar_consensus_options               = '-q 20 -t 0.6 -n N'
    params.ivar_trim_options                    = ''
    params.ivar_variants_options                = '-q 20 -t 0.6'
    params.minimap2_options                     = '-K 20M'
    params.minimum_depth                        = 100
    params.mpileup_depth                        = 8000
    params.multiqc_options                      = ''
    params.mafft_options                        = '--maxambiguous 0.5'
    params.phytreeviz_options                   = ''
    params.samtools_ampliconclip_options        = ''
    params.samtools_coverage_options            = ''
    params.samtools_flagstat_options            = ''
    params.samtools_depth_options               = ''
    params.samtools_stats_options               = ''
    params.samtools_ampliconstats_options       = '--max-amplicon-length 3000 --max-amplicons 3000'
    params.samtools_plot_ampliconstats_options  = '-size 1200,900 -size2 1200,900 -size3 1200,900'
    params.samtools_markdup_options             = ''
    params.samtools_fixmate_options             = ''
    params.seqyclean_contaminant_file           = '/Adapters_plus_PhiX_174.fasta'
    params.seqyclean_options                    = '-minlen 25 -qual'
    params.snpdists_options                     = '-c'

    //# for optional contamination determination
    params.kraken2                              = false
    params.kraken2_db                           = null
    params.kraken2_options                      = ''

    //# for using an included version of nextclade dataset
    params.download_nextclade_dataset           = true

    //# organism specific
    params.freyja                               = true
    params.freyja_aggregate                     = true
    params.nextclade                            = true
    params.pangolin                             = true
    params.pango_collapse                       = true
    params.vadr                                 = true

    params.pangolin_options                     = ''
    params.pango_collapse_options               = ''
    params.vadr_mdir                            = '/opt/vadr/vadr-models'
    params.nextclade_options                    = ''
    params.freyja_variants_options              = ''
    params.freyja_demix_options                 = ""

    params.freyja_aggregate_options             = ''
    params.freyja_plot_options                  = ''
    params.freyja_plot_filetype                 = 'png'


    // Boilerplate options copied from nf-core and may have no functionality
    publish_dir_mode             = 'copy'
    email                        = null
    email_on_fail                = null
    plaintext_email              = false
    monochrome_logs              = false
    hook_url                     = null
    help                         = false
    help_full                    = false
    show_hidden                  = false
    version                      = false
    // Config options
    config_profile_name        = null
    config_profile_description = null

    custom_config_version      = 'master'
    custom_config_base         = "https://raw.githubusercontent.com/nf-core/configs/${params.custom_config_version}"
    config_profile_contact     = null
    config_profile_url         = null

    // Schema validation default options
    validate_params            = true
}

//########## Setting the Profile ##########
profiles {
  docker {
    docker.enabled          = true
    conda.enabled           = false
    singularity.enabled     = false
    podman.enabled          = false
    shifter.enabled         = false
    charliecloud.enabled    = false
    apptainer.enabled       = false
    docker.runOptions       = '-u $(id -u):$(id -g)'
  }
  singularity {
    singularity.enabled     = true
    singularity.autoMounts  = true
    conda.enabled           = false
    docker.enabled          = false
    podman.enabled          = false
    shifter.enabled         = false
    charliecloud.enabled    = false
    apptainer.enabled       = false
  }
  podman {
    podman.enabled          = true
    conda.enabled           = false
    docker.enabled          = false
    singularity.enabled     = false
    shifter.enabled         = false
    charliecloud.enabled    = false
    apptainer.enabled       = false
  }
  artic_V3 {
    params.primer_set = 'ncov_V3'
  }
  artic_V4 {
    params.primer_set = 'ncov_V4'
  }
  artic_V4_1 {
    params.primer_set = 'ncov_V4.1'
  }
  artic_V5_3_2 {
    params.primer_set = 'ncov_V5.3.2'
  }
  sarscov2 {
    includeConfig './conf/sarscov2.config'
  }
  mpx {
    includeConfig './conf/mpx.config'
  }
  mpx_idt {
    includeConfig './conf/mpx_idt.config'
  }
  mpx_primalseq {
    includeConfig './conf/mpx_primalseq.config'
  }
  mpx_yale {
    includeConfig './conf/mpx_yale.config'
  }
  wastewater {
    includeConfig './conf/sarscov2_wastewater.config'
  }  
  uphl {
    includeConfig './conf/uphl.config'
  }
  test {
    includeConfig './conf/test.config'
  }
  test1 {
    includeConfig './conf/test1.config'
  }
  test2 {
    includeConfig './conf/test2.config'
  }
  test_full { 
    includeConfig 'conf/test.config' 
  }
}

def trace_timestamp = new java.util.Date().format( 'yyyy-MM-dd_HH-mm-ss')
timeline {
    enabled = true
    file    = "${params.outdir}/pipeline_info/execution_timeline_${trace_timestamp}.html"
}
report {
    enabled = true
    file    = "${params.outdir}/pipeline_info/execution_report_${trace_timestamp}.html"
}
trace {
    enabled = true
    file    = "${params.outdir}/pipeline_info/execution_trace_${trace_timestamp}.txt"
}
dag {
    enabled = true
    file    = "${params.outdir}/pipeline_info/pipeline_dag_${trace_timestamp}.html"
}

//########## manifest values     ##########
manifest {
  mainScript        = 'main.nf'
  nextflowVersion   = '>=22.10.7'
  name              = 'Cecret'
  author            = 'Erin Young'
  homePage          = 'https://github.com/UPHL-BioNGS/Cecret'
  version           = 'v3.15.24330'
  defaultBranch     = 'master'
  recurseSubmodules = false
  description       = 'Reference-based consensus creation'
  doi               = ''
}

//######## nf-core assistance #####
validation {
    help {
        enabled = true
        command = "nextflow run UPHL-BioNGS/Cecret -profile <docker/singularity/.../institute> --sample_sheet samplesheet.csv --outdir cecret"
        fullParameter = "help_full"
        showHiddenParameter = "show_hidden"
    }
}

// Load modules.config for DSL2 module specific options
includeConfig 'conf/modules.config'